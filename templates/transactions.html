{% extends 'base.html' %}
{% block content %}
<div class="space-y-6 sm:space-y-8">
  <!-- Header -->
  <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
    <div>
      <h1 class="text-2xl sm:text-3xl font-bold text-white mb-2">Transaction History</h1>
      <p class="text-slate-400">Track and manage all your financial transactions</p>
    </div>
    <a href="{{ url_for('add_transaction') }}" class="btn-primary-glow px-4 sm:px-6 py-3 rounded-xl text-white font-semibold inline-flex items-center justify-center sm:justify-start">
      <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
        <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd"></path>
      </svg>
      <span class="hidden sm:inline">Add Transaction</span>
      <span class="sm:hidden">Add</span>
    </a>
  </div>

  <!-- Filters Card -->
  <div class="bg-gradient-to-br from-slate-800 to-slate-900 rounded-2xl border border-slate-700 p-4 sm:p-6 card-hover">
    <h3 class="text-lg font-semibold text-white mb-4">Filter Transactions</h3>
    <form class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
      <!-- Category Filter -->
      <div>
        <label class="block text-sm font-medium text-slate-300 mb-2">Category</label>
        <div class="relative">
          <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
            <svg class="h-5 w-5 text-slate-400" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zm0 4a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1V8zm8 0a1 1 0 011-1h4a1 1 0 011 1v2a1 1 0 01-1 1h-4a1 1 0 01-1-1V8z" clip-rule="evenodd"></path>
            </svg>
          </div>
          <input 
            type="text" 
            name="category" 
            value="{{ request.args.get('category','') }}"
            class="input-dark w-full pl-10 pr-4 py-3 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all"
            placeholder="Filter by category"
          >
        </div>
      </div>

      <!-- Start Date -->
      <div>
        <label class="block text-sm font-medium text-slate-300 mb-2">Start Date</label>
        <div class="relative">
          <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
            <svg class="h-5 w-5 text-slate-400" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1 1zM4 7h12v9a1 1 0 01-1 1H5a1 1 0 01-1-1V7z" clip-rule="evenodd"></path>
            </svg>
          </div>
          <input 
            type="date" 
            name="start" 
            value="{{ request.args.get('start','') }}"
            class="input-dark w-full pl-10 pr-4 py-3 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all"
          >
        </div>
      </div>

      <!-- End Date -->
      <div>
        <label class="block text-sm font-medium text-slate-300 mb-2">End Date</label>
        <div class="relative">
          <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
            <svg class="h-5 w-5 text-slate-400" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1 1zM4 7h12v9a1 1 0 01-1 1H5a1 1 0 01-1-1V7z" clip-rule="evenodd"></path>
            </svg>
          </div>
          <input 
            type="date" 
            name="end" 
            value="{{ request.args.get('end','') }}"
            class="input-dark w-full pl-10 pr-4 py-3 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all"
          >
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="flex flex-col sm:flex-row items-stretch sm:items-end space-y-2 sm:space-y-0 sm:space-x-2">
        <button type="submit" class="btn-primary-glow px-4 sm:px-6 py-3 rounded-xl text-white font-medium flex-1">
          <svg class="w-4 h-4 mr-2 inline-block" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd"></path>
          </svg>
          Filter
        </button>
        <a href="{{ url_for('transactions') }}" class="border border-slate-600 hover:border-slate-500 text-slate-300 hover:text-white px-4 sm:px-6 py-3 rounded-xl font-medium text-center transition-all hover:bg-slate-800/50">
          Clear
        </a>
      </div>
    </form>
  </div>

  <!-- Transactions Table -->
  <div class="bg-gradient-to-br from-slate-800 to-slate-900 rounded-2xl border border-slate-700 card-hover overflow-hidden transactions-table">
    <div class="px-4 sm:px-6 py-4 border-b border-slate-700">
      <h3 class="text-lg font-semibold text-white">Recent Transactions</h3>
    </div>

    {% if items %}
    <div class="overflow-x-auto">
      <table class="w-full min-w-full">
        <thead class="bg-slate-800/50 border-b border-slate-700">
          <tr>
            <th class="px-3 sm:px-6 py-3 sm:py-4 text-left text-xs font-medium text-slate-400 uppercase tracking-wider">Date</th>
            <th class="px-3 sm:px-6 py-3 sm:py-4 text-left text-xs font-medium text-slate-400 uppercase tracking-wider">Type</th>
            <th class="px-3 sm:px-6 py-3 sm:py-4 text-left text-xs font-medium text-slate-400 uppercase tracking-wider">Category</th>
            <th class="px-3 sm:px-6 py-3 sm:py-4 text-left text-xs font-medium text-slate-400 uppercase tracking-wider">Amount</th>
            <th class="hidden sm:table-cell px-3 sm:px-6 py-3 sm:py-4 text-left text-xs font-medium text-slate-400 uppercase tracking-wider">Note</th>
            <th class="px-3 sm:px-6 py-3 sm:py-4 text-left text-xs font-medium text-slate-400 uppercase tracking-wider">Actions</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-slate-700">
          {% for t in items %}
          <tr class="hover:bg-slate-800/30 transition-colors">
            <td class="px-3 sm:px-6 py-3 sm:py-4 whitespace-nowrap">
              <div class="text-sm font-medium text-white">{{ t.date.strftime('%Y-%m-%d') }}</div>
              <div class="text-xs text-slate-400 hidden sm:block">{{ t.date.strftime('%A') }}</div>
            </td>
            <td class="px-3 sm:px-6 py-3 sm:py-4 whitespace-nowrap">
              <span class="inline-flex items-center px-2 sm:px-3 py-1 rounded-full text-xs font-medium
                {% if t.type=='income' %}bg-green-900/30 text-green-400 border border-green-500/20{% else %}bg-red-900/30 text-red-400 border border-red-500/20{% endif %}">
                {% if t.type=='income' %}
                  <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                  </svg>
                {% else %}
                  <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M16.707 10.293a1 1 0 010 1.414l-6 6a1 1 0 01-1.414 0l-6-6a1 1 0 111.414-1.414L9 14.586V3a1 1 0 012 0v11.586l4.293-4.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                  </svg>
                {% endif %}
                <span class="hidden sm:inline">{{ t.type.title() }}</span>
                <span class="sm:hidden">{{ t.type.title()[:3] }}</span>
              </span>
            </td>
            <td class="px-3 sm:px-6 py-3 sm:py-4 whitespace-nowrap">
              <div class="flex items-center">
                <div class="w-6 h-6 sm:w-8 sm:h-8 bg-primary-500/20 rounded-lg flex items-center justify-center mr-2 sm:mr-3">
                  {% if t.category == 'Food' %}
                    <span class="text-xs sm:text-sm">üçΩÔ∏è</span>
                  {% elif t.category == 'Transport' %}
                    <span class="text-xs sm:text-sm">üöó</span>
                  {% elif t.category == 'Bills' %}
                    <span class="text-xs sm:text-sm">üì±</span>
                  {% elif t.category == 'Shopping' %}
                    <span class="text-xs sm:text-sm">üõçÔ∏è</span>
                  {% elif t.category == 'Health' %}
                    <span class="text-xs sm:text-sm">üè•</span>
                  {% elif t.category == 'Education' %}
                    <span class="text-xs sm:text-sm">üìö</span>
                  {% elif t.category == 'Entertainment' %}
                    <span class="text-xs sm:text-sm">üé¨</span>
                  {% elif t.category == 'Travel' %}
                    <span class="text-xs sm:text-sm">‚úàÔ∏è</span>
                  {% elif t.category == 'Salary' %}
                    <span class="text-xs sm:text-sm">üíº</span>
                  {% elif t.category == 'Business' %}
                    <span class="text-xs sm:text-sm">üè¢</span>
                  {% elif t.category == 'Investment' %}
                    <span class="text-xs sm:text-sm">üìà</span>
                  {% elif t.category == 'Gift' %}
                    <span class="text-xs sm:text-sm">üéÅ</span>
                  {% else %}
                    <span class="text-xs sm:text-sm">üìã</span>
                  {% endif %}
                </div>
                <div>
                  <div class="text-sm font-medium text-white truncate max-w-20 sm:max-w-none">{{ t.category }}</div>
                </div>
              </div>
            </td>
            <td class="px-3 sm:px-6 py-3 sm:py-4 whitespace-nowrap">
              <div class="text-base sm:text-lg font-semibold {% if t.type=='income' %}text-green-400{% else %}text-red-400{% endif %}">
                {% if t.type=='income' %}+{% else %}-{% endif %}‚Çπ{{ t.amount|round(2) }}
              </div>
            </td>
            <td class="hidden sm:table-cell px-3 sm:px-6 py-3 sm:py-4">
              <div class="text-sm text-slate-300 max-w-xs truncate">
                {{ t.note or '-' }}
              </div>
            </td>
            <td class="px-3 sm:px-6 py-3 sm:py-4 whitespace-nowrap">
              <div class="flex items-center space-x-1 sm:space-x-2">
                <a href="{{ url_for('edit_transaction', transaction_id=t.id) }}" class="text-primary-400 hover:text-primary-300 p-1 sm:p-2 rounded-lg hover:bg-primary-500/10 transition-colors" title="Edit">
                  <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"></path>
                  </svg>
                </a>
                <form action="{{ url_for('delete_transaction_user', transaction_id=t.id) }}" method="POST" style="display:inline;" onsubmit="return confirmDelete({{ t.id }})">
                  <button type="submit" class="text-red-400 hover:text-red-300 p-1 sm:p-2 rounded-lg hover:bg-red-500/10 transition-colors" title="Delete">
                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                      <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                    </svg>
                  </button>
                </form>
              </div>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- Pagination (if needed) -->
    <div class="px-6 py-4 border-t border-slate-700 flex items-center justify-between">
      <div class="text-sm text-slate-400">
        Showing {{ items|length }} transactions
      </div>
      <div class="flex items-center space-x-2">
        <button class="px-3 py-1 text-sm border border-slate-600 rounded-lg text-slate-400 hover:text-white hover:border-slate-500 transition-colors disabled:opacity-50" disabled>
          Previous
        </button>
        <span class="px-3 py-1 text-sm bg-primary-500 text-white rounded-lg">1</span>
        <button class="px-3 py-1 text-sm border border-slate-600 rounded-lg text-slate-400 hover:text-white hover:border-slate-500 transition-colors disabled:opacity-50" disabled>
          Next
        </button>
      </div>
    </div>
    {% else %}
    <!-- Empty State -->
    <div class="text-center py-16">
      <div class="w-24 h-24 bg-slate-800 rounded-full flex items-center justify-center mx-auto mb-6">
        <svg class="w-12 h-12 text-slate-600" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zm0 4a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1V8zm8 0a1 1 0 011-1h4a1 1 0 011 1v2a1 1 0 01-1 1h-4a1 1 0 01-1-1V8z" clip-rule="evenodd"></path>
        </svg>
      </div>
      <h3 class="text-xl font-semibold text-white mb-2">No transactions found</h3>
      <p class="text-slate-400 mb-6 max-w-md mx-auto">
        You haven't recorded any transactions yet, or no transactions match your current filters.
      </p>
      <div class="flex flex-col sm:flex-row gap-4 justify-center">
        <a href="{{ url_for('add_transaction') }}" class="btn-primary-glow px-6 py-3 rounded-xl text-white font-semibold inline-flex items-center justify-center">
          <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd"></path>
          </svg>
          Add Your First Transaction
        </a>
        {% if request.args.get('category') or request.args.get('start') or request.args.get('end') %}
        <a href="{{ url_for('transactions') }}" class="border border-slate-600 hover:border-slate-500 text-slate-300 hover:text-white px-6 py-3 rounded-xl font-semibold text-center transition-all hover:bg-slate-800/50">
          Clear Filters
        </a>
        {% endif %}
      </div>
    </div>
    {% endif %}
  </div>

  <!-- Summary Cards -->
  {% if items %}
  <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
    <div class="stats-card card-hover rounded-2xl p-6">
      <div class="flex items-center justify-between mb-4">
        <div class="w-10 h-10 bg-green-500/20 rounded-xl flex items-center justify-center">
          <svg class="w-5 h-5 text-green-400" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
          </svg>
        </div>
        <span class="text-xs text-green-400 bg-green-500/10 px-2 py-1 rounded-full">Income</span>
      </div>
      <div class="space-y-1">
        <h3 class="text-sm text-slate-400 font-medium">Total Income</h3>
        <p class="text-2xl font-bold text-green-400">
          ‚Çπ{{ items|selectattr('type', 'equalto', 'income')|map(attribute='amount')|sum|round(2) }}
        </p>
      </div>
    </div>

    <div class="stats-card card-hover rounded-2xl p-6">
      <div class="flex items-center justify-between mb-4">
        <div class="w-10 h-10 bg-red-500/20 rounded-xl flex items-center justify-center">
          <svg class="w-5 h-5 text-red-400" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M16.707 10.293a1 1 0 010 1.414l-6 6a1 1 0 01-1.414 0l-6-6a1 1 0 111.414-1.414L9 14.586V3a1 1 0 012 0v11.586l4.293-4.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
          </svg>
        </div>
        <span class="text-xs text-red-400 bg-red-500/10 px-2 py-1 rounded-full">Expenses</span>
      </div>
      <div class="space-y-1">
        <h3 class="text-sm text-slate-400 font-medium">Total Expenses</h3>
        <p class="text-2xl font-bold text-red-400">
          ‚Çπ{{ items|selectattr('type', 'equalto', 'expense')|map(attribute='amount')|sum|round(2) }}
        </p>
      </div>
    </div>

    <div class="stats-card card-hover rounded-2xl p-6">
      <div class="flex items-center justify-between mb-4">
        <div class="w-10 h-10 bg-primary-500/20 rounded-xl flex items-center justify-center">
          <svg class="w-5 h-5 text-primary-400" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M4 4a2 2 0 00-2 2v4a2 2 0 002 2V6h10a2 2 0 00-2-2H4zm2 6a2 2 0 012-2h8a2 2 0 012 2v4a2 2 0 01-2 2H8a2 2 0 01-2-2v-4zm6 4a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"></path>
          </svg>
        </div>
        <span class="text-xs text-primary-400 bg-primary-500/10 px-2 py-1 rounded-full">Net</span>
      </div>
      <div class="space-y-1">
        <h3 class="text-sm text-slate-400 font-medium">Net Amount</h3>
        {% set net_amount = (items|selectattr('type', 'equalto', 'income')|map(attribute='amount')|sum) - (items|selectattr('type', 'equalto', 'expense')|map(attribute='amount')|sum) %}
        <p class="text-2xl font-bold {% if net_amount >= 0 %}text-green-400{% else %}text-red-400{% endif %}">
          {% if net_amount >= 0 %}+{% endif %}‚Çπ{{ net_amount|round(2) }}
        </p>
      </div>
    </div>
  </div>
  {% endif %}
</div>

<script>
// Add focus effects to form elements
document.addEventListener('DOMContentLoaded', function() {
  const inputs = document.querySelectorAll('input, select');
  
  inputs.forEach(input => {
    input.addEventListener('focus', function() {
      this.parentElement.classList.add('ring-2', 'ring-primary-500');
    });
    
    input.addEventListener('blur', function() {
      this.parentElement.classList.remove('ring-2', 'ring-primary-500');
    });
  });
  
  // Auto-submit form when dates are selected (optional)
  const dateInputs = document.querySelectorAll('input[type="date"]');
  dateInputs.forEach(input => {
    input.addEventListener('change', function() {
      // Optional: auto-submit when both dates are filled
      const form = this.closest('form');
      const startDate = form.querySelector('input[name="start"]').value;
      const endDate = form.querySelector('input[name="end"]').value;
      
      if (startDate && endDate) {
        // Uncomment to enable auto-submit
        // form.submit();
      }
    });
  });
});

// Add row hover effects
document.querySelectorAll('tbody tr').forEach(row => {
  row.addEventListener('mouseenter', function() {
    this.classList.add('bg-slate-800/50');
  });
  
  row.addEventListener('mouseleave', function() {
    this.classList.remove('bg-slate-800/50');
  });
});

// Confirm delete action
function confirmDelete(transactionId) {
  return confirm('Are you sure you want to delete this transaction? This action cannot be undone.');
}
</script>
{% endblock %}