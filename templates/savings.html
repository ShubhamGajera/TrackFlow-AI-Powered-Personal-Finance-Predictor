{% extends 'base.html' %}
{% block content %}
<div class="space-y-6 sm:space-y-8 savings-grid">
  <!-- Header -->
  <div class="text-center">
    <h1 class="text-2xl sm:text-3xl font-bold text-white mb-2">Savings & Goals</h1>
    <p class="text-slate-400 max-w-2xl mx-auto px-4">
      Set financial goals, track your progress, and get personalized savings strategies to achieve your dreams.
    </p>
  </div>

  <!-- Savings Target & Current Month Overview -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 sm:gap-8">
    <!-- Savings Target Card -->
    <div class="bg-gradient-to-br from-slate-800 to-slate-900 rounded-2xl border border-slate-700 p-4 sm:p-6 card-hover">
      <h3 class="text-lg font-semibold text-white mb-4 sm:mb-6">Monthly Savings Target</h3>
      
      <form method="POST" class="space-y-4 sm:space-y-6">
        <div>
          <label class="block text-sm font-medium text-slate-300 mb-2">
            Set Your Monthly Goal
          </label>
          <div class="relative">
            <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
              <span class="text-slate-400 text-xl font-medium">‚Çπ</span>
            </div>
            <input 
              type="number" 
              name="monthly_savings_target" 
              step="0.01" 
              min="0"
              value="{{ (goal.monthly_savings_target if goal else 0) | round(2) }}"
              class="input-dark w-full pl-12 pr-4 py-3 sm:py-4 text-xl sm:text-2xl rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all"
              placeholder="5000.00"
            >
          </div>
        </div>

        <button type="submit" class="btn-primary-glow w-full py-3 px-4 sm:px-6 rounded-xl text-white font-semibold text-base sm:text-lg transition-all hover:scale-[1.02] focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 focus:ring-offset-slate-900">
          <svg class="w-5 h-5 inline-block mr-2" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
          </svg>
          Update Goal
        </button>
      </form>

      <!-- Progress Visualization -->
      {% if goal and goal.monthly_savings_target > 0 %}
      <div class="mt-6 sm:mt-8 p-4 bg-slate-800/50 rounded-xl border border-slate-700">
        <div class="flex items-center justify-between mb-3">
          <span class="text-sm text-slate-400">Progress This Month</span>
          <span class="text-sm font-medium text-white">
            ‚Çπ{{ snapshot.this_month_income - snapshot.this_month_expense }} / ‚Çπ{{ goal.target_amount or goal.monthly_savings_target }}
          </span>
        </div>
        {% set progress_percent = ((snapshot.this_month_income - snapshot.this_month_expense) / (goal.target_amount or goal.monthly_savings_target) * 100) if (goal.target_amount or goal.monthly_savings_target) > 0 else 0 %}
        <div class="w-full bg-slate-700 rounded-full h-3 mb-2">
          <div class="bg-gradient-to-r from-green-500 to-green-400 h-3 rounded-full transition-all duration-1000" style="width: {{ [progress_percent, 100]|min }}%"></div>
        </div>
        <div class="flex justify-between text-xs">
          <span class="text-slate-400">0%</span>
          <span class="text-slate-400">{{ progress_percent|round(1) }}%</span>
          <span class="text-slate-400">100%</span>
        </div>
      </div>
      {% endif %}
    </div>

    <!-- Personalized Tips -->
    <div class="bg-gradient-to-br from-slate-800 to-slate-900 rounded-2xl border border-slate-700 p-4 sm:p-6 card-hover">
      <h3 class="text-lg font-semibold text-white mb-4 sm:mb-6">Personalized Savings Tips</h3>
      
      {% if tips %}
      <div class="space-y-3 sm:space-y-4">
        {% for tip in tips %}
        <div class="flex items-start space-x-3 p-3 sm:p-4 bg-primary-500/10 border border-primary-500/20 rounded-lg">
          <div class="w-6 h-6 bg-primary-500/20 rounded-full flex items-center justify-center mt-0.5 flex-shrink-0">
            <svg class="w-3 h-3 text-primary-400" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M11.3 1.046A1 1 0 0112 2v5h4a1 1 0 01.82 1.573l-7 10A1 1 0 018 18v-5H4a1 1 0 01-.82-1.573l7-10a1 1 0 011.12-.38z" clip-rule="evenodd"></path>
            </svg>
          </div>
          <p class="text-sm text-slate-300">{{ tip }}</p>
        </div>
        {% endfor %}
      </div>
      {% else %}
      <div class="text-center py-6 sm:py-8">
        <div class="w-16 h-16 bg-slate-800 rounded-full flex items-center justify-center mx-auto mb-4">
          <svg class="w-8 h-8 text-slate-600" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M11.3 1.046A1 1 0 0112 2v5h4a1 1 0 01.82 1.573l-7 10A1 1 0 018 18v-5H4a1 1 0 01-.82-1.573l7-10a1 1 0 011.12-.38z" clip-rule="evenodd"></path>
          </svg>
        </div>
        <p class="text-slate-400 mb-4">No personalized tips available yet.</p>
        <a href="{{ url_for('add_transaction') }}" class="text-primary-400 hover:text-primary-300 font-medium">Add transactions to see tailored suggestions ‚Üí</a>
      </div>
      {% endif %}
    </div>
  </div>

  <!-- This Month Snapshot -->
  <div class="bg-gradient-to-br from-slate-800 to-slate-900 rounded-2xl border border-slate-700 p-4 sm:p-6 card-hover">
    <h3 class="text-lg font-semibold text-white mb-4 sm:mb-6">This Month's Financial Snapshot</h3>
    
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6">
      <!-- Income Card -->
      <div class="bg-gradient-to-r from-green-900/20 to-green-800/20 border border-green-500/20 rounded-xl p-4 sm:p-6">
        <div class="flex items-center justify-between mb-4">
          <div class="w-10 h-10 sm:w-12 sm:h-12 bg-green-500/20 rounded-xl flex items-center justify-center">
            <svg class="w-5 h-5 sm:w-6 sm:h-6 text-green-400" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
            </svg>
          </div>
          <span class="text-xs text-green-400 bg-green-500/10 px-2 py-1 rounded-full">Income</span>
        </div>
        <div class="space-y-1">
          <h4 class="text-sm text-slate-400">Total Income</h4>
          <p class="text-xl sm:text-2xl font-bold text-white">‚Çπ {{ snapshot.this_month_income }}</p>
        </div>
      </div>

      <!-- Expenses Card -->
      <div class="bg-gradient-to-r from-red-900/20 to-red-800/20 border border-red-500/20 rounded-xl p-4 sm:p-6">
        <div class="flex items-center justify-between mb-4">
          <div class="w-10 h-10 sm:w-12 sm:h-12 bg-red-500/20 rounded-xl flex items-center justify-center">
            <svg class="w-5 h-5 sm:w-6 sm:h-6 text-red-400" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M16.707 10.293a1 1 0 010 1.414l-6 6a1 1 0 01-1.414 0l-6-6a1 1 0 111.414-1.414L9 14.586V3a1 1 0 012 0v11.586l4.293-4.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
            </svg>
          </div>
          <span class="text-xs text-red-400 bg-red-500/10 px-2 py-1 rounded-full">Expenses</span>
        </div>
        <div class="space-y-1">
          <h4 class="text-sm text-slate-400">Total Expenses</h4>
          <p class="text-xl sm:text-2xl font-bold text-white">‚Çπ {{ snapshot.this_month_expense }}</p>
        </div>
      </div>

      <!-- Net Savings Card -->
      <div class="bg-gradient-to-r from-primary-900/20 to-purple-900/20 border border-primary-500/20 rounded-xl p-4 sm:p-6 sm:col-span-2 lg:col-span-1">
        <div class="flex items-center justify-between mb-4">
          <div class="w-10 h-10 sm:w-12 sm:h-12 bg-primary-500/20 rounded-xl flex items-center justify-center">
            <svg class="w-5 h-5 sm:w-6 sm:h-6 text-primary-400" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M4 4a2 2 0 00-2 2v4a2 2 0 002 2V6h10a2 2 0 00-2-2H4zm2 6a2 2 0 012-2h8a2 2 0 012 2v4a2 2 0 01-2 2H8a2 2 0 01-2-2v-4zm6 4a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"></path>
            </svg>
          </div>
          <span class="text-xs text-primary-400 bg-primary-500/10 px-2 py-1 rounded-full">Savings</span>
        </div>
        <div class="space-y-1">
          <h4 class="text-sm text-slate-400">Net Savings</h4>
          {% set net_savings = snapshot.this_month_income - snapshot.this_month_expense %}
          <p class="text-xl sm:text-2xl font-bold {% if net_savings >= 0 %}text-green-400{% else %}text-red-400{% endif %}">
            {% if net_savings >= 0 %}+{% endif %}‚Çπ {{ net_savings }}
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- Top Categories & Savings Opportunities -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 sm:gap-8">
    <!-- Top Categories -->
    <div class="bg-gradient-to-br from-slate-800 to-slate-900 rounded-2xl border border-slate-700 p-4 sm:p-6 card-hover">
      <h3 class="text-lg font-semibold text-white mb-4 sm:mb-6">Top Expense Categories</h3>
      
      {% if snapshot.top_categories %}
      <div class="space-y-3 sm:space-y-4">
        {% for cat, val in snapshot.top_categories %}
        <div class="flex items-center justify-between p-3 bg-slate-800/50 rounded-lg border border-slate-700/50">
          <div class="flex items-center space-x-3 min-w-0 flex-1">
            <div class="w-6 h-6 sm:w-8 sm:h-8 bg-primary-500/20 rounded-lg flex items-center justify-center flex-shrink-0">
              {% if cat == 'Food' %}
                <span class="text-xs sm:text-sm">üçΩÔ∏è</span>
              {% elif cat == 'Transport' %}
                <span class="text-xs sm:text-sm">üöó</span>
              {% elif cat == 'Bills' %}
                <span class="text-xs sm:text-sm">üì±</span>
              {% elif cat == 'Shopping' %}
                <span class="text-xs sm:text-sm">üõçÔ∏è</span>
              {% elif cat == 'Health' %}
                <span class="text-xs sm:text-sm">üè•</span>
              {% elif cat == 'Education' %}
                <span class="text-xs sm:text-sm">üìö</span>
              {% elif cat == 'Entertainment' %}
                <span class="text-xs sm:text-sm">üé¨</span>
              {% elif cat == 'Travel' %}
                <span class="text-xs sm:text-sm">‚úàÔ∏è</span>
              {% else %}
                <span class="text-xs sm:text-sm">üìã</span>
              {% endif %}
            </div>
            <span class="text-white font-medium truncate">{{ cat }}</span>
          </div>
          <div class="text-right flex-shrink-0 ml-2">
            <div class="text-white font-semibold text-sm sm:text-base">‚Çπ {{ val|round(2) }}</div>
            <div class="text-xs text-slate-400 hidden sm:block">
              {{ ((val / snapshot.this_month_expense * 100) if snapshot.this_month_expense > 0 else 0)|round(1) }}% of total
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
      {% else %}
      <div class="text-center py-8">
        <div class="w-16 h-16 bg-slate-800 rounded-full flex items-center justify-center mx-auto mb-4">
          <svg class="w-8 h-8 text-slate-600" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zm0 4a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1V8zm8 0a1 1 0 011-1h4a1 1 0 011 1v2a1 1 0 01-1 1h-4a1 1 0 01-1-1V8z" clip-rule="evenodd"></path>
          </svg>
        </div>
        <p class="text-slate-400">No expense data available yet.</p>
      </div>
      {% endif %}
    </div>

    <!-- Savings Strategies -->
    <div class="bg-gradient-to-br from-slate-800 to-slate-900 rounded-2xl border border-slate-700 p-6 card-hover">
      <h3 class="text-lg font-semibold text-white mb-6">Savings Strategies</h3>
      
      <div class="space-y-4">
        <div class="bg-blue-900/20 border border-blue-500/20 rounded-lg p-4">
          <div class="flex items-start space-x-3">
            <div class="w-8 h-8 bg-blue-500/20 rounded-lg flex items-center justify-center mt-0.5 flex-shrink-0">
              <span class="text-lg">üí∞</span>
            </div>
            <div>
              <h4 class="text-sm font-medium text-blue-400 mb-1">50/30/20 Rule</h4>
              <p class="text-xs text-slate-300">Allocate 50% for needs, 30% for wants, and 20% for savings.</p>
            </div>
          </div>
        </div>

        <div class="bg-green-900/20 border border-green-500/20 rounded-lg p-4">
          <div class="flex items-start space-x-3">
            <div class="w-8 h-8 bg-green-500/20 rounded-lg flex items-center justify-center mt-0.5 flex-shrink-0">
              <span class="text-lg">üéØ</span>
            </div>
            <div>
              <h4 class="text-sm font-medium text-green-400 mb-1">Emergency Fund</h4>
              <p class="text-xs text-slate-300">Build 3-6 months of expenses as an emergency fund for financial security.</p>
            </div>
          </div>
        </div>

        <div class="bg-purple-900/20 border border-purple-500/20 rounded-lg p-4">
          <div class="flex items-start space-x-3">
            <div class="w-8 h-8 bg-purple-500/20 rounded-lg flex items-center justify-center mt-0.5 flex-shrink-0">
              <span class="text-lg">üìà</span>
            </div>
            <div>
              <h4 class="text-sm font-medium text-purple-400 mb-1">Auto-Invest</h4>
              <p class="text-xs text-slate-300">Set up automatic transfers to savings accounts on payday.</p>
            </div>
          </div>
        </div>

        <div class="bg-yellow-900/20 border border-yellow-500/20 rounded-lg p-4">
          <div class="flex items-start space-x-3">
            <div class="w-8 h-8 bg-yellow-500/20 rounded-lg flex items-center justify-center mt-0.5 flex-shrink-0">
              <span class="text-lg">üîç</span>
            </div>
            <div>
              <h4 class="text-sm font-medium text-yellow-400 mb-1">Track Subscriptions</h4>
              <p class="text-xs text-slate-300">Review monthly subscriptions and cancel unused services.</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Savings Challenges -->
  <div class="bg-gradient-to-br from-slate-800 to-slate-900 rounded-2xl border border-slate-700 p-6 card-hover">
    <h3 class="text-lg font-semibold text-white mb-6">30-Day Savings Challenges</h3>
    
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      <!-- Challenge 1: No-Spend Days -->
      <div class="bg-slate-800/50 border border-slate-700 rounded-xl p-6 hover:bg-slate-800/70 transition-colors cursor-pointer group challenge-card" data-challenge="no-spend">
        <div class="w-12 h-12 bg-red-500/20 rounded-xl flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform">
          <span class="text-2xl">üö´</span>
        </div>
        <h4 class="text-center font-semibold text-white mb-2">No-Spend Days</h4>
        <p class="text-center text-sm text-slate-400 mb-4">Complete 5 no-spend days this week</p>
        <div class="text-center mb-3">
          <span class="text-green-400 font-semibold">Save ‚Çπ800-1200</span>
        </div>
        <div class="flex justify-center space-x-2">
          <div class="w-3 h-3 bg-slate-600 rounded-full challenge-dot" data-day="1"></div>
          <div class="w-3 h-3 bg-slate-600 rounded-full challenge-dot" data-day="2"></div>
          <div class="w-3 h-3 bg-slate-600 rounded-full challenge-dot" data-day="3"></div>
          <div class="w-3 h-3 bg-slate-600 rounded-full challenge-dot" data-day="4"></div>
          <div class="w-3 h-3 bg-slate-600 rounded-full challenge-dot" data-day="5"></div>
        </div>
        <div class="text-center mt-3">
          <span class="text-xs text-slate-500">Progress: <span class="challenge-progress">0</span>/5</span>
        </div>
      </div>

      <!-- Challenge 2: Cook at Home -->
      <div class="bg-slate-800/50 border border-slate-700 rounded-xl p-6 hover:bg-slate-800/70 transition-colors cursor-pointer group challenge-card" data-challenge="cook-home">
        <div class="w-12 h-12 bg-green-500/20 rounded-xl flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform">
          <span class="text-2xl">ü•ó</span>
        </div>
        <h4 class="text-center font-semibold text-white mb-2">Cook at Home</h4>
        <p class="text-center text-sm text-slate-400 mb-4">Cook 7 meals at home this week</p>
        <div class="text-center mb-3">
          <span class="text-green-400 font-semibold">Save ‚Çπ1,400-2,100</span>
        </div>
        <div class="flex justify-center space-x-2">
          <div class="w-3 h-3 bg-slate-600 rounded-full challenge-dot" data-day="1"></div>
          <div class="w-3 h-3 bg-slate-600 rounded-full challenge-dot" data-day="2"></div>
          <div class="w-3 h-3 bg-slate-600 rounded-full challenge-dot" data-day="3"></div>
          <div class="w-3 h-3 bg-slate-600 rounded-full challenge-dot" data-day="4"></div>
          <div class="w-3 h-3 bg-slate-600 rounded-full challenge-dot" data-day="5"></div>
          <div class="w-3 h-3 bg-slate-600 rounded-full challenge-dot" data-day="6"></div>
          <div class="w-3 h-3 bg-slate-600 rounded-full challenge-dot" data-day="7"></div>
        </div>
        <div class="text-center mt-3">
          <span class="text-xs text-slate-500">Progress: <span class="challenge-progress">0</span>/7</span>
        </div>
      </div>

      <!-- Challenge 3: Walk & Save -->
      <div class="bg-slate-800/50 border border-slate-700 rounded-xl p-6 hover:bg-slate-800/70 transition-colors cursor-pointer group challenge-card" data-challenge="walk-save">
        <div class="w-12 h-12 bg-blue-500/20 rounded-xl flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform">
          <span class="text-2xl">üö∂</span>
        </div>
        <h4 class="text-center font-semibold text-white mb-2">Walk & Save</h4>
        <p class="text-center text-sm text-slate-400 mb-4">Walk instead of ride-sharing 5 times</p>
        <div class="text-center mb-3">
          <span class="text-green-400 font-semibold">Save ‚Çπ750-1,250</span>
        </div>
        <div class="flex justify-center space-x-2">
          <div class="w-3 h-3 bg-slate-600 rounded-full challenge-dot" data-day="1"></div>
          <div class="w-3 h-3 bg-slate-600 rounded-full challenge-dot" data-day="2"></div>
          <div class="w-3 h-3 bg-slate-600 rounded-full challenge-dot" data-day="3"></div>
          <div class="w-3 h-3 bg-slate-600 rounded-full challenge-dot" data-day="4"></div>
          <div class="w-3 h-3 bg-slate-600 rounded-full challenge-dot" data-day="5"></div>
        </div>
        <div class="text-center mt-3">
          <span class="text-xs text-slate-500">Progress: <span class="challenge-progress">0</span>/5</span>
        </div>
      </div>

      <!-- Challenge 4: Review Subscriptions -->
      <div class="bg-slate-800/50 border border-slate-700 rounded-xl p-6 hover:bg-slate-800/70 transition-colors cursor-pointer group challenge-card" data-challenge="subscriptions">
        <div class="w-12 h-12 bg-purple-500/20 rounded-xl flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform">
          <span class="text-2xl">üì±</span>
        </div>
        <h4 class="text-center font-semibold text-white mb-2">Review Subscriptions</h4>
        <p class="text-center text-sm text-slate-400 mb-4">Cancel 2 unused subscriptions</p>
        <div class="text-center mb-3">
          <span class="text-green-400 font-semibold">Save ‚Çπ800-1,500/month</span>
        </div>
        <div class="flex justify-center space-x-2">
          <div class="w-3 h-3 bg-slate-600 rounded-full challenge-dot" data-day="1"></div>
          <div class="w-3 h-3 bg-slate-600 rounded-full challenge-dot" data-day="2"></div>
        </div>
        <div class="text-center mt-3">
          <span class="text-xs text-slate-500">Progress: <span class="challenge-progress">0</span>/2</span>
        </div>
      </div>

      <!-- Challenge 5: Coffee Challenge -->
      <div class="bg-slate-800/50 border border-slate-700 rounded-xl p-6 hover:bg-slate-800/70 transition-colors cursor-pointer group challenge-card" data-challenge="coffee">
        <div class="w-12 h-12 bg-yellow-500/20 rounded-xl flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform">
          <span class="text-2xl">‚òï</span>
        </div>
        <h4 class="text-center font-semibold text-white mb-2">Coffee Challenge</h4>
        <p class="text-center text-sm text-slate-400 mb-4">Make coffee at home for 10 days</p>
        <div class="text-center mb-3">
          <span class="text-green-400 font-semibold">Save ‚Çπ600-1,000</span>
        </div>
        <div class="flex justify-center space-x-2 flex-wrap">
          <div class="w-3 h-3 bg-slate-600 rounded-full challenge-dot" data-day="1"></div>
          <div class="w-3 h-3 bg-slate-600 rounded-full challenge-dot" data-day="2"></div>
          <div class="w-3 h-3 bg-slate-600 rounded-full challenge-dot" data-day="3"></div>
          <div class="w-3 h-3 bg-slate-600 rounded-full challenge-dot" data-day="4"></div>
          <div class="w-3 h-3 bg-slate-600 rounded-full challenge-dot" data-day="5"></div>
          <div class="w-3 h-3 bg-slate-600 rounded-full challenge-dot" data-day="6"></div>
          <div class="w-3 h-3 bg-slate-600 rounded-full challenge-dot" data-day="7"></div>
          <div class="w-3 h-3 bg-slate-600 rounded-full challenge-dot" data-day="8"></div>
          <div class="w-3 h-3 bg-slate-600 rounded-full challenge-dot" data-day="9"></div>
          <div class="w-3 h-3 bg-slate-600 rounded-full challenge-dot" data-day="10"></div>
        </div>
        <div class="text-center mt-3">
          <span class="text-xs text-slate-500">Progress: <span class="challenge-progress">0</span>/10</span>
        </div>
      </div>

      <!-- Challenge 6: Entertainment Swap -->
      <div class="bg-slate-800/50 border border-slate-700 rounded-xl p-6 hover:bg-slate-800/70 transition-colors cursor-pointer group challenge-card" data-challenge="entertainment">
        <div class="w-12 h-12 bg-pink-500/20 rounded-xl flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform">
          <span class="text-2xl">üé¨</span>
        </div>
        <h4 class="text-center font-semibold text-white mb-2">Entertainment Swap</h4>
        <p class="text-center text-sm text-slate-400 mb-4">Find 3 free entertainment alternatives</p>
        <div class="text-center mb-3">
          <span class="text-green-400 font-semibold">Save ‚Çπ500-1,200</span>
        </div>
        <div class="flex justify-center space-x-2">
          <div class="w-3 h-3 bg-slate-600 rounded-full challenge-dot" data-day="1"></div>
          <div class="w-3 h-3 bg-slate-600 rounded-full challenge-dot" data-day="2"></div>
          <div class="w-3 h-3 bg-slate-600 rounded-full challenge-dot" data-day="3"></div>
        </div>
        <div class="text-center mt-3">
          <span class="text-xs text-slate-500">Progress: <span class="challenge-progress">0</span>/3</span>
        </div>
      </div>
    </div>

    <!-- Challenge Progress Summary -->
    <div class="mt-8 p-6 bg-slate-800/50 rounded-xl border border-slate-700">
      <h4 class="text-lg font-semibold text-white mb-4">Weekly Challenge Progress</h4>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
        <div class="flex items-center justify-between p-3 bg-slate-700/50 rounded-lg">
          <span class="text-slate-300">Total Challenges:</span>
          <span class="text-white font-semibold">6</span>
        </div>
        <div class="flex items-center justify-between p-3 bg-slate-700/50 rounded-lg">
          <span class="text-slate-300">Completed:</span>
          <span class="text-green-400 font-semibold" id="totalCompleted">0</span>
        </div>
        <div class="flex items-center justify-between p-3 bg-slate-700/50 rounded-lg">
          <span class="text-slate-300">Potential Savings:</span>
          <span class="text-green-400 font-semibold">‚Çπ4,450-7,750</span>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// Enhanced interactive animations for savings challenges
document.addEventListener('DOMContentLoaded', function() {
  const challenges = document.querySelectorAll('.challenge-card');
  let totalCompleted = 0;
  
  // Load saved progress from localStorage
  loadChallengeProgress();
  
  challenges.forEach(challenge => {
    challenge.addEventListener('click', function() {
      const challengeType = this.dataset.challenge;
      const dots = this.querySelectorAll('.challenge-dot');
      const progressSpan = this.querySelector('.challenge-progress');
      const currentProgress = parseInt(progressSpan.textContent.split('/')[0]);
      const maxProgress = parseInt(progressSpan.textContent.split('/')[1]);
      
      if (currentProgress < maxProgress) {
        // Mark next dot as completed
        const nextDot = dots[currentProgress];
        if (nextDot) {
          nextDot.classList.remove('bg-slate-600');
          nextDot.classList.add('bg-green-500');
          nextDot.classList.add('animate-pulse');
          
          // Update progress
          const newProgress = currentProgress + 1;
          progressSpan.textContent = `${newProgress}/${maxProgress}`;
          
          // Save progress
          saveChallengeProgress(challengeType, newProgress);
          
          // Check if challenge is completed
          if (newProgress === maxProgress) {
            completeChallenge(this);
            totalCompleted++;
            updateTotalProgress();
          }
        }
      }
    });
  });

  function completeChallenge(challengeCard) {
    // Add completion effect
    challengeCard.classList.add('bg-green-900/20', 'border-green-500/20');
    challengeCard.classList.remove('bg-slate-800/50', 'border-slate-700');
    
    // Add checkmark
    const icon = challengeCard.querySelector('.w-12 span');
    if (icon) {
      setTimeout(() => {
        icon.innerHTML = '‚úÖ';
        icon.classList.add('animate-bounce');
      }, 300);
    }
    
    // Add celebration effect
    challengeCard.style.transform = 'scale(1.05)';
    setTimeout(() => {
      challengeCard.style.transform = 'scale(1)';
    }, 200);
  }

  function saveChallengeProgress(challengeType, progress) {
    const savedProgress = JSON.parse(localStorage.getItem('challengeProgress') || '{}');
    savedProgress[challengeType] = progress;
    localStorage.setItem('challengeProgress', JSON.stringify(savedProgress));
  }

  function loadChallengeProgress() {
    const savedProgress = JSON.parse(localStorage.getItem('challengeProgress') || '{}');
    
    challenges.forEach(challenge => {
      const challengeType = challenge.dataset.challenge;
      const savedProgressValue = savedProgress[challengeType] || 0;
      const dots = challenge.querySelectorAll('.challenge-dot');
      const progressSpan = challenge.querySelector('.challenge-progress');
      
      // Update progress display
      progressSpan.textContent = `${savedProgressValue}/${progressSpan.textContent.split('/')[1]}`;
      
      // Mark completed dots
      for (let i = 0; i < savedProgressValue; i++) {
        if (dots[i]) {
          dots[i].classList.remove('bg-slate-600');
          dots[i].classList.add('bg-green-500');
        }
      }
      
      // Check if challenge is completed
      if (savedProgressValue >= parseInt(progressSpan.textContent.split('/')[1])) {
        completeChallenge(challenge);
        totalCompleted++;
      }
    });
    
    updateTotalProgress();
  }

  function updateTotalProgress() {
    const totalCompletedElement = document.getElementById('totalCompleted');
    if (totalCompletedElement) {
      totalCompletedElement.textContent = totalCompleted;
    }
  }

  // Animate progress bars
  const progressBars = document.querySelectorAll('[style*="width:"]');
  progressBars.forEach(bar => {
    const targetWidth = bar.style.width;
    bar.style.width = '0%';
    
    setTimeout(() => {
      bar.style.transition = 'width 1.5s ease-out';
      bar.style.width = targetWidth;
    }, 500);
  });

  // Add challenge reset functionality (double-click to reset)
  challenges.forEach(challenge => {
    let clickCount = 0;
    let clickTimer;
    
    challenge.addEventListener('click', function() {
      clickCount++;
      clearTimeout(clickTimer);
      
      clickTimer = setTimeout(() => {
        if (clickCount === 2) {
          // Double click detected - reset challenge
          resetChallenge(this);
        }
        clickCount = 0;
      }, 300);
    });
  });

  function resetChallenge(challengeCard) {
    const challengeType = challengeCard.dataset.challenge;
    const dots = challengeCard.querySelectorAll('.challenge-dot');
    const progressSpan = challengeCard.querySelector('.challenge-progress');
    const maxProgress = parseInt(progressSpan.textContent.split('/')[1]);
    
    // Reset dots
    dots.forEach(dot => {
      dot.classList.remove('bg-green-500', 'animate-pulse');
      dot.classList.add('bg-slate-600');
    });
    
    // Reset progress
    progressSpan.textContent = `0/${maxProgress}`;
    
    // Reset card appearance
    challengeCard.classList.remove('bg-green-900/20', 'border-green-500/20');
    challengeCard.classList.add('bg-slate-800/50', 'border-slate-700');
    
    // Reset icon
    const icon = challengeCard.querySelector('.w-12 span');
    if (icon) {
      icon.innerHTML = challengeCard.querySelector('.w-12').dataset.originalIcon || 'üí∞';
      icon.classList.remove('animate-bounce');
    }
    
    // Save reset progress
    saveChallengeProgress(challengeType, 0);
    
    // Update total progress
    totalCompleted--;
    updateTotalProgress();
  }

  // Store original icons for reset functionality
  challenges.forEach(challenge => {
    const icon = challenge.querySelector('.w-12 span');
    if (icon) {
      challenge.querySelector('.w-12').dataset.originalIcon = icon.innerHTML;
    }
  });
});

// Add savings target input validation
const savingsInput = document.querySelector('input[name="monthly_savings_target"]');
if (savingsInput) {
  savingsInput.addEventListener('input', function() {
    const value = parseFloat(this.value);
    const form = this.closest('form');
    const submitBtn = form.querySelector('button[type="submit"]');
    
    if (value > 0) {
      submitBtn.classList.remove('opacity-50');
      submitBtn.disabled = false;
    } else {
      submitBtn.classList.add('opacity-50');
      submitBtn.disabled = true;
    }
  });
}
</script>
{% endblock %}